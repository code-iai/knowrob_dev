(function(){var k,o,T,F,S,af,ad,Q,d,a,ab,x,v,b,e,O,K,Z,u,J,B,p,V,h,i,aa,G,m,g,z,t,I,w,Y,ac,R,E,U,P,r,H,M,C,n,c,s,ae,f,X,y,W,j,A,D,L,l,N,ag=Object.prototype.hasOwnProperty,q=function(ak,ai){for(var ah in ai){if(ag.call(ai,ah)){ak[ah]=ai[ah]}}function aj(){this.constructor=ak}aj.prototype=ai.prototype;ak.prototype=new aj;ak.__super__=ai.prototype;return ak};c=function(aj,ak){var ai,ah;ah="";for(ai=1;ai<=aj;ai+=1){ah+="    "}ah+=ak;return ah};n=function(ah,ai){return c(ah,"|-"+ai)};C=function(ai,ah,aj){if(!(ai!=null)){return""}if(typeof ai==="string"){return n(ah,aj+("'"+ai+"'\n"))}if(typeof ai==="number"){return n(ah,aj+(""+ai+"\n"))}if(typeof ai==="boolean"){return n(ah,aj+(""+ai+"\n"))}if(ai.getInfo!=null){return ai.getInfo(ah,aj)}return n(ah,aj+"<unknown data type>\n")};Y=(function(){function ah(ai){this.url=ai.trim().replace(/^#/,"");this.object=null}ah.prototype.getInfo=function(ai,aj){return n(ai,aj+("<urlLink url='"+this.url+"'>\n"))};return ah})();b=(function(){function ah(ai,aj){this.url=ai;this.scope=aj;this.object=null}ah.prototype.getInfo=function(ai,aj){return n(ai,aj+("<fxLink url='"+this.url+"'>\n"))};return ah})();z=(function(){function ah(an,ai){var al,ar,aq,ao,aj,am,ak,ap;this.url=ai;this.object=null;this.id=null;this.sids=[];this.member=null;this.indices=null;this.dotSyntax=false;this.arrSyntax=false;am=ai.split("/");this.id=am.shift();if(this.id==="."){this.id=an}while(am.length>1){this.sids.push(am.shift())}if(am.length>0){aj=am[0];aq=aj.indexOf(".")>=0;ar=aj.indexOf("(")>=0;if(aq){am=aj.split(".");this.sids.push(am.shift());this.member=am.shift();this.dotSyntax=true}else{if(ar){al=aj.split("(");this.sids.push(al.shift());this.indices=[];for(ak=0,ap=al.length;ak<ap;ak++){ao=al[ak];this.indices.push(parseInt(ao.replace(/\)/,""),10))}this.arrSyntax=true}else{this.sids.push(aj)}}}}ah.prototype.getInfo=function(ai,ak){var aj,al;al="<sidLink id='"+this.id+"'";if(this.sids.length>0){al+=", sids='[";al+=this.sids.join(",");al+="]'"}al+=">\n";return aj=n(ai,ak+al)};return ah})();o=(function(){function ah(){this.animTarget={};this.animTarget.channels=[];this.animTarget.activeChannels=[];this.animTarget.dataRows=null;this.animTarget.dataColumns=null}ah.prototype.selectAnimation=function(ak){var al,aj,ai,am;this.animTarget.activeChannels=[];am=this.animTarget.channels;for(aj=0,ai=am.length;aj<ai;aj++){al=am[aj];if(ak(al,aj)){this.animTarget.activeChannels.push(al)}}};ah.prototype.selectAnimationById=function(ai){this.selectAnimation(function(ak,aj){return ak.animation.id===ai})};ah.prototype.selectAnimationByName=function(ai){this.selectAnimation(function(ak,aj){return ak.animation.name===ai})};ah.prototype.selectAllAnimations=function(ai){this.selectAnimation(function(ak,aj){return true})};ah.prototype.applyAnimationKeyframe=function(ai){throw new Error("applyAnimationKeyframe() not implemented")};ah.prototype.initAnimationTarget=function(){throw new Error("initAnimationTarget() not implemented")};ah.prototype.resetAnimation=function(){throw new Error("resetAnimation() not implemented")};return ah})();T=(function(){function ah(){this.unit=1;this.upAxis=null}ah.prototype.getInfo=function(ai,aj){return n(ai,aj+"<asset>\n")};return ah})();E=(function(){function ah(){this.id=null;this.children=[];this.sidChildren=[]}ah.prototype.getInfo=function(ai,an){var ao,ak,am,aj,al;ak=n(ai,an+("<visualScene id='"+this.id+"'>\n"));if(this.children!=null){al=this.children;for(am=0,aj=al.length;am<aj;am++){ao=al[am];ak+=C(ao,ai+1,"child ")}}return ak};return ah})();U=(function(){function ah(){this.id=null;this.sid=null;this.name=null;this.type=null;this.layer=null;this.parent=null;this.children=[];this.sidChildren=[];this.transformations=[];this.geometries=[];this.controllers=[];this.lights=[];this.cameras=[]}ah.prototype.getInfo=function(av,aw){var ar,at,ao,an,al,aj,az,aB,aA,ay,ax,ai,au,aq,ap,am,ak;at=n(av,aw+("<visualSceneNode id='"+this.id+"', sid='"+this.sid+"', name='"+this.name+"'>\n"));if(this.geometries!=null){au=this.geometries;for(ao=0,az=au.length;ao<az;ao++){ar=au[ao];at+=C(ar,av+1,"geometry ")}}if(this.controllers!=null){aq=this.controllers;for(an=0,aB=aq.length;an<aB;an++){ar=aq[an];at+=C(ar,av+1,"controller ")}}if(this.lights!=null){ap=this.lights;for(al=0,aA=ap.length;al<aA;al++){ar=ap[al];at+=C(ar,av+1,"light ")}}if(this.cameras!=null){am=this.cameras;for(aj=0,ay=am.length;aj<ay;aj++){ar=am[aj];at+=C(ar,av+1,"camera ")}}if(this.children!=null){ak=this.children;for(ai=0,ax=ak.length;ai<ax;ai++){ar=ak[ai];at+=C(ar,av+1,"child ")}}return at};ah.prototype.getTransformMatrix=function(ai){var ak,al,an,aj,am;ak=new THREE.Matrix4;ai.identity();am=this.transformations;for(an=0,aj=am.length;an<aj;an++){al=am[an];al.getTransformMatrix(ak);ai.multiplyMatrices(ai,ak)}};return ah})();m=(function(ai){q(ah,ai);function ah(){ah.__super__.constructor.call(this);this.sid=null;this.type=null;this.data=null;this.originalData=null;this.node=null}ah.prototype.getTransformMatrix=function(aj){var ak;switch(this.type){case"matrix":X(this.data,0,aj);break;case"rotate":ak=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);aj.makeRotationAxis(ak,this.data[3]*P);break;case"translate":aj.makeTranslation(this.data[0],this.data[1],this.data[2]);break;case"scale":aj.makeScale(this.data[0],this.data[1],this.data[2]);break;default:throw new Error("transform type '"+this.type+"' not implemented")}};ah.prototype.applyAnimationKeyframe=function(am){var an,al,aj,ap,ak,ao,aq;ao=this.animTarget.activeChannels;for(ap=0,ak=ao.length;ap<ak;ap++){an=ao[ap];aj=an.outputData;for(al=0,aq=an.count-1;al<=aq;al+=1){this.data[an.offset+al]=aj[am*an.stride+al]}}};ah.prototype.initAnimationTarget=function(){var al,aj,ak,am;this.originalData=new Float32Array(this.data.length);am=this.data;for(al=0,ak=am.length;al<ak;al++){aj=am[al];this.originalData[al]=this.data[al]}switch(this.type){case"matrix":this.animTarget.dataColumns=4;this.animTarget.dataRows=4;break;case"rotate":this.animTarget.dataColumns=4;this.animTarget.dataRows=1;break;case"translate":case"scale":this.animTarget.dataColumns=3;this.animTarget.dataRows=1;break;default:throw new Error("transform type '"+this.type+"' not implemented")}};ah.prototype.resetAnimation=function(){var al,aj,ak,am;am=this.originalData;for(al=0,ak=am.length;al<ak;al++){aj=am[al];this.data[al]=this.originalData[al]}};return ah})(o);J=(function(){function ah(){this.geometry=null;this.materials=[];this.sidChildren=[]}ah.prototype.getInfo=function(ai,ao){var al,ak,an,aj,am;ak=n(ai,ao+"<instanceGeometry>\n");ak+=C(this.geometry,ai+1,"geometry ");am=this.materials;for(an=0,aj=am.length;an<aj;an++){al=am[an];ak+=C(al,ai+1,"material ")}return ak};return ah})();u=(function(){function ah(){this.controller=null;this.skeletons=[];this.materials=[];this.sidChildren=[]}ah.prototype.getInfo=function(ak,aq){var ar,aj,am,ao,an,at,ai,ap,al;aj=n(ak,aq+"<instanceController>\n");aj+=C(this.controller,ak+1,"controller ");ap=this.skeletons;for(ao=0,at=ap.length;ao<at;ao++){am=ap[ao];aj+=C(am,ak+1,"skeleton ")}al=this.materials;for(an=0,ai=al.length;an<ai;an++){ar=al[an];aj+=C(ar,ak+1,"material ")}return aj};return ah})();p=(function(){function ah(){this.sid=null;this.symbol=null;this.material=null;this.name=null;this.vertexInputs={};this.params={}}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<instanceMaterial sid='"+this.sid+"'>\n"));aj+=C(this.material,ai+1,"material ");return aj};return ah})();B=(function(){function ah(){this.sid=null;this.light=null;this.name=null;this.sidChildren=[]}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+"<instanceLight>\n");aj+=C(this.light,ai+1,"light ");return aj};return ah})();Z=(function(){function ah(){this.sid=null;this.camera=null;this.name=null;this.sidChildren=[]}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+"<instanceCamera>\n");aj+=C(this.light,ai+1,"camera ");return aj};return ah})();O=(function(){function ah(){this.id=null;this.initFrom=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<image id='"+this.id+"'>\n"));aj+=C(this.initFrom,ai+1,"initFrom ");return aj};return ah})();d=(function(){function ah(){this.id=null;this.sids={};this.technique=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<effect id='"+this.id+"'>\n"));aj+=C(this.technique,ai+1,"technique ");return aj};return ah})();x=(function(){function ah(){this.sid=null;this.sids={};this.fxScope=null;this.shading=null;this.emission=null;this.ambient=null;this.diffuse=null;this.specular=null;this.shininess=null;this.reflective=null;this.transparent=null;this.bump=null;this.reflectivity=null;this.transparency=null;this.index_of_refraction=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<technique sid='"+this.sid+"'>\n"));return aj};return ah})();ab=(function(){function ah(){this.sid=null;this.fxScope=null;this.type=null;this.initFrom=null;this.format=null;this.size=null;this.viewportRatio=null;this.mipLevels=null;this.mipmapGenerate=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<surface sid='"+this.sid+"'>\n"));aj+=C(this.initFrom,ai+1,"initFrom ");return aj};return ah})();a=(function(){function ah(){this.sid=null;this.fxScope=null;this.surface=null;this.image=null;this.wrapS=null;this.wrapT=null;this.minfilter=null;this.magfilter=null;this.borderColor=null;this.mipmapMaxLevel=null;this.mipmapBias=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<sampler sid='"+this.sid+"'>\n"));aj+=C(this.image,ai+1,"image ");aj+=C(this.surface,ai+1,"surface ");return aj};return ah})();ad=(function(){function ah(){this.color=null;this.textureSampler=null;this.texcoord=null;this.opaque=null;this.bumptype=null}return ah})();G=(function(){function ah(){this.id=null;this.name=null;this.effect=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<material id='"+this.id+"' name='"+this.name+"'>\n"));aj+=C(this.effect,ai+1,"effect ");return aj};return ah})();e=(function(){function ah(){this.id=null;this.name=null;this.sources=[];this.vertices=null;this.triangles=[]}ah.prototype.getInfo=function(al,aq){var ak,ai,at,ao,an,ar,aj,ap,am;ak=n(al,aq+("<geometry id='"+this.id+"' name='"+this.name+"'>\n"));ap=this.sources;for(ao=0,ar=ap.length;ao<ar;ao++){ai=ap[ao];ak+=C(ai,al+1,"source ")}ak+=C(this.vertices,al+1,"vertices ");am=this.triangles;for(an=0,aj=am.length;an<aj;an++){at=am[an];ak+=C(at,al+1,"triangles ")}return ak};return ah})();I=(function(){function ah(){this.id=null;this.name=null;this.sourceId=null;this.count=null;this.stride=null;this.data=null;this.params={}}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<source id='"+this.id+"' name='"+this.name+"'>\n"));aj+=C(this.sourceId,ai+1,"sourceId ");return aj};return ah})();R=(function(){function ah(){this.id=null;this.name=null;this.inputs=[]}ah.prototype.getInfo=function(ai,ao){var al,ak,an,aj,am;ak=n(ai,ao+("<vertices id='"+this.id+"' name='"+this.name+"'>\n"));am=this.inputs;for(an=0,aj=am.length;an<aj;an++){al=am[an];ak+=C(al,ai+1,"input ")}return ak};return ah})();w=(function(){function ah(){this.name=null;this.count=null;this.material=null;this.inputs=[];this.indices=null}ah.prototype.getInfo=function(ai,ao){var al,ak,an,aj,am;ak=n(ai,ao+("<triangles name='"+this.name+"'>\n"));ak+=C(this.material,ai+1,"material ");am=this.inputs;for(an=0,aj=am.length;an<aj;an++){al=am[an];ak+=C(al,ai+1,"input ")}return ak};return ah})();K=(function(){function ah(){this.semantic=null;this.source=null;this.offset=null;this.set=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<input semantic="+this.semantic+">\n"));aj+=C(this.source,ai+1,"source ");return aj};return ah})();Q=(function(){function ah(){this.id=null;this.name=null;this.skin=null;this.morph=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+("<controller id='"+this.id+"', name='"+this.name+"'>\n"));aj+=C(this.skin,ai+1,"skin ");aj+=C(this.morph,ai+1,"morph ");return aj};return ah})();t=(function(){function ah(){this.source=null;this.bindShapeMatrix=null;this.sources=[];this.joints=null;this.vertexWeights=null}ah.prototype.getInfo=function(ai,ao){var ak,an,am,aj,al;ak=n(ai,ao+("<skin source='"+this.source+"'>\n"));ak+=C(this.bindShapeMatrix,ai+1,"bind_shape_matrix ");al=this.sources;for(am=0,aj=al.length;am<aj;am++){an=al[am];ak+=C(an,ai+1,"source ")}ak+=C(this.joints,ai+1,"joints ");ak+=C(this.vertexWeights,ai+1,"vertex_weights ");return ak};return ah})();V=(function(){function ah(){this.joints=null;this.invBindMatrices=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+"<joints>\n");aj+=C(this.joints,ai+1,"joints ");aj+=C(this.invBindMatrices,ai+1,"invBindMatrices ");return aj};return ah})();ac=(function(){function ah(){this.inputs=[];this.vcount=null;this.v=null;this.joints=null;this.weights=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+"<vertex_weights>\n");aj+=C(this.joints,ai+1,"joints ");aj+=C(this.weights,ai+1,"weights ");return aj};return ah})();k=(function(){function ah(){this.id=null;this.name=null;this.parent=null;this.rootId=null;this.rootName=null;this.animations=[];this.sources=[];this.samplers=[];this.channels=[]}ah.prototype.getInfo=function(ar,av){var aw,aB,ap,at,au,an,al,aj,ai,ay,aA,az,ax,aq,ao,am,ak;ap=n(ar,av+("<animation id='"+this.id+"', name='"+name+"'>\n"));aq=this.animations;for(an=0,ay=aq.length;an<ay;an++){aw=aq[an];ap+=C(aw,ar+1,"animation ")}ao=this.sources;for(al=0,aA=ao.length;al<aA;al++){au=ao[al];ap+=C(au,ar+1,"source ")}am=this.samplers;for(aj=0,az=am.length;aj<az;aj++){at=am[aj];ap+=C(at,ar+1,"sampler ")}ak=this.channels;for(ai=0,ax=ak.length;ai<ax;ai++){aB=ak[ai];ap+=C(aB,ar+1,"channel ")}return ap};return ah})();g=(function(){function ah(){this.id=null;this.input=null;this.outputs=[];this.inTangents=[];this.outTangents=[];this.interpolation=null}ah.prototype.getInfo=function(am,au){var ak,al,aw,ar,aq,ap,av,aj,ai,at,ao,an;al=n(am,au+("<sampler id='"+this.id+"'>\n"));al+=C(this.input,am+1,"input ");at=this.outputs;for(ar=0,av=at.length;ar<av;ar++){ak=at[ar];al+=C(ak,am+1,"output ")}ao=this.inTangents;for(aq=0,aj=ao.length;aq<aj;aq++){aw=ao[aq];al+=C(aw,am+1,"inTangent ")}an=this.outTangents;for(ap=0,ai=an.length;ap<ai;ap++){aw=an[ap];al+=C(aw,am+1,"outTangent ")}al+=C(this.interpolation,am+1,"interpolation ");return al};return ah})();af=(function(){function ah(){this.animation=null;this.source=null;this.target=null}ah.prototype.getInfo=function(ai,ak){var aj;aj=n(ai,ak+"<channel>\n");aj+=C(this.source,ai+1,"source ");aj+=C(this.target,ai+1,"target ");return aj};return ah})();h=(function(){function ah(){this.id=null;this.name=null;this.type=null;this.color=null;this.params={};this.sidChildren=[]}ah.prototype.getInfo=function(ai,aj){return n(ai,aj+"<light>\n")};return ah})();i=(function(){function ah(){this.sid=null;this.name=null;this.value=null}return ah})();F=(function(){function ah(){this.id=null;this.name=null;this.type=null;this.params={};this.sidChildren=[]}ah.prototype.getInfo=function(ai,aj){return n(ai,aj+"<camera>\n")};return ah})();S=(function(){function ah(){this.sid=null;this.name=null;this.value=null}return ah})();r=(function(){function ah(){this.inputData=null;this.outputData=null;this.offset=null;this.stride=null;this.count=null;this.animation=null}return ah})();M=(function(){function ah(){this.index=null;this.node=null;this.sid=null;this.parent=null;this.isAnimated=null;this.matrix=new THREE.Matrix4;this.worldMatrix=new THREE.Matrix4;this.invBindMatrix=new THREE.Matrix4;this.skinMatrix=new THREE.Matrix4;this.worldMatrixDirty=true}ah.prototype.getWorldMatrix=function(){if(this.worldMatrixDirty){if(this.parent!=null){this.worldMatrix.multiplyMatrices(this.parent.getWorldMatrix(),this.matrix)}else{this.worldMatrix.copy(this.matrix)}this.worldMatrixDirty=false}return this.worldMatrix};ah.prototype.applyAnimation=function(am){var aj,al,ai,ak;if(this.isAnimated){ak=this.node.transformations;for(al=0,ai=ak.length;al<ai;al++){aj=ak[al];aj.applyAnimationKeyframe(am)}this.node.getTransformMatrix(this.matrix)}this.worldMatrixDirty=true;return null};ah.prototype.updateSkinMatrix=function(aj){var ai;ai=this.getWorldMatrix();this.skinMatrix.multiplyMatrices(ai,this.invBindMatrix);this.skinMatrix.multiplyMatrices(this.skinMatrix,aj);return null};return ah})();H=(function(){function ah(){this.materials=[];this.indices={};this.needTangents=false}return ah})();v=(function(){function ah(ai){var aj,al,ak;this._url=null;this._baseUrl=null;this._loader=ai;this._options={};ak=ai.options;for(aj in ak){al=ak[aj];this._options[aj]=al}this._log=ai.log;this._readyCallback=null;this._progressCallback=null;this.dae={};this.dae.ids={};this.dae.animationTargets=[];this.dae.libEffects=[];this.dae.libMaterials=[];this.dae.libGeometries=[];this.dae.libControllers=[];this.dae.libLights=[];this.dae.libCameras=[];this.dae.libImages=[];this.dae.libVisualScenes=[];this.dae.libAnimations=[];this.dae.asset=null;this.dae.scene=null;this.threejs={};this.threejs.scene=null;this.threejs.images=[];this.threejs.geometries=[];this.threejs.materials=[];this.scene=null}ah.prototype.setUrl=function(ai){var aj;if(ai!=null){this._url=ai;aj=ai.split("/");aj.pop();this._baseUrl=(aj.length<1?".":aj.join("/"))+"/"}else{this._url="";this._baseUrl=""}};ah.prototype.getLibInfo=function(ao,aj,am){var ap,ai,al,an,ak;if(ao==null){return""}al=n(aj,am+(" <"+am+">\n"));ai=0;for(an=0,ak=ao.length;an<ak;an++){ap=ao[an];al+=C(ap,aj+1,"");ai+=1}if(ai>0){return al}else{return""}};ah.prototype.getInfo=function(ai,ak){var aj;aj="<collada url='"+this.url+"'>\n";aj+=C(this.dae.asset,ai+1,"asset ");aj+=C(this.dae.scene,ai+1,"scene ");aj+=this.getLibInfo(this.dae.libEffects,ai+1,"library_effects");aj+=this.getLibInfo(this.dae.libMaterials,ai+1,"library_materials");aj+=this.getLibInfo(this.dae.libGeometries,ai+1,"library_geometries");aj+=this.getLibInfo(this.dae.libControllers,ai+1,"library_controllers");aj+=this.getLibInfo(this.dae.libLights,ai+1,"library_lights");aj+=this.getLibInfo(this.dae.libCameras,ai+1,"library_cameras");aj+=this.getLibInfo(this.dae.libImages,ai+1,"library_images");aj+=this.getLibInfo(this.dae.libVisualScenes,ai+1,"library_visual_scenes");aj+=this.getLibInfo(this.dae.libAnimations,ai+1,"library_animations");return aj};ah.prototype._reportUnexpectedChild=function(ai,aj){this._log("Skipped unknown <"+ai.nodeName+"> child <"+aj.nodeName+">.",aa.messageWarning)};ah.prototype._reportUnhandledExtra=function(ai,aj){this._log("Skipped element <"+ai.nodeName+">/<"+aj.nodeName+">. Element is legal, but not handled by this loader.",aa.messageWarning)};ah.prototype._getAttributeAsFloat=function(ak,aj,ai){var al;al=ak.getAttribute(aj);if(al!=null){return parseFloat(al)}else{return ai}};ah.prototype._getAttributeAsInt=function(ak,aj,ai){var al;al=ak.getAttribute(aj);if(al!=null){return parseInt(al,10)}else{return ai}};ah.prototype._addUrlTarget=function(aj,ak,ai){var al;if(ak!=null){ak.push(aj)}al=aj.id;if(!(al!=null)){if(ai){this._log("Object has no ID.",aa.messageError)}return}if(this.dae.ids[al]!=null){this._log("There is already an object with ID "+al+".",aa.messageError);return}this.dae.ids[al]=aj};ah.prototype._resolveUrlLink=function(ai){ai.object=this.dae.ids[ai.url];if(!(ai.object!=null)){this._log("Could not resolve URL #"+ai.url,aa.messageError);return false}return true};ah.prototype._addFxTarget=function(aj,ak){var ai;ai=aj.sid;if(!(ai!=null)){this._log("Cannot add a FX target: object has no SID.",aa.messageError);return}if(ak.sids[ai]!=null){this._log("There is already an FX target with SID "+ai+".",aa.messageError);return}aj.fxScope=ak;ak.sids[ai]=aj};ah.prototype._resolveFxLink=function(aj){var ai;ai=aj.scope;while(!(aj.object!=null)&&(ai!=null)){aj.object=ai.sids[aj.url];ai=ai.fxScope}if(!(aj.object!=null)){this._log("Could not resolve FX parameter #"+aj.url,aa.messageError);return false}return true};ah.prototype._addSidTarget=function(ai,aj){if(!(aj.sidChildren!=null)){aj.sidChildren=[]}aj.sidChildren.push(ai)};ah.prototype._findSidTarget=function(at,au){var ar,am,aw,aq,al,aj,ai,ao,an,av,ak,ap;ai=au.split("/");aw=at;ar=null;for(ao=0,av=ai.length;ao<av;ao++){al=ai[ao];aq=[aw];while(aq.length!==0){am=aq.shift();if(am.sid===al){ar=am;break}if(am.sidChildren!=null){ap=am.sidChildren;for(an=0,ak=ap.length;an<ak;an++){aj=ap[an];aq.push(aj)}}}if(!(ar!=null)){return null}aw=ar}return ar};ah.prototype._resolveSidLink=function(at){var av,ar,al,aw,aq,ak,ai,ao,an,au,aj,ap,am;av=this.dae.ids[at.id];if(!(av!=null)){this._log("Could not resolve SID #"+at.url+", missing base ID "+at.id,aa.messageError);return false}aw=av;ar=null;ap=at.sids;for(ao=0,au=ap.length;ao<au;ao++){ak=ap[ao];aq=[aw];while(aq.length!==0){al=aq.shift();if(al.sid===ak){ar=al;break}if(al.sidChildren!=null){am=al.sidChildren;for(an=0,aj=am.length;an<aj;an++){ai=am[an];aq.push(ai)}}}if(!(ar!=null)){this._log("Could not resolve SID #"+at.url+", missing SID part "+ak,aa.messageError);return false}aw=ar}at.object=ar;return true};ah.prototype._getLinkTarget=function(aj,ai){if(!(aj!=null)){return null}if(!(aj.object!=null)){if(aj instanceof Y){this._resolveUrlLink(aj)}else{if(aj instanceof z){this._resolveSidLink(aj)}else{if(aj instanceof b){this._resolveFxLink(aj)}else{this._log("Trying to resolve an object that is not a link",aa.messageError)}}}}if((ai!=null)&&(aj.object!=null)&&!(aj.object instanceof ai)){this._log("Link "+aj.url+" does not link to a "+ai.name,aa.messageError)}return aj.object};ah.prototype._parseXml=function(ak){var ai,aj;ai=ak.childNodes[0];if((ai!=null?(aj=ai.nodeName)!=null?aj.toUpperCase():void 0:void 0)==="COLLADA"){this._parseCollada(ai)}else{this._log("Can not parse document, top level element is not <COLLADA>.",aa.messageError)}};ah.prototype._parseCollada=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"asset":this._parseAsset(am);break;case"scene":this._parseScene(am);break;case"library_effects":this._parseLibEffect(am);break;case"library_materials":this._parseLibMaterial(am);break;case"library_geometries":this._parseLibGeometry(am);break;case"library_images":this._parseLibImage(am);break;case"library_visual_scenes":this._parseLibVisualScene(am);break;case"library_controllers":this._parseLibController(am);break;case"library_animations":this._parseLibAnimation(am);break;case"library_lights":this._parseLibLight(am);break;case"library_cameras":this._parseLibCamera(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseAsset=function(aj){var am,al,ai,ak;if(!this.dae.asset){this.dae.asset=new T()}ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"unit":this.dae.asset.unit=this._getAttributeAsFloat(am,"meter");break;case"up_axis":this.dae.asset.upAxis=am.textContent.toUpperCase().charAt(0);break;case"contributor":case"created":case"modified":case"revision":case"title":case"subject":case"keywords":break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseScene=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"instance_visual_scene":this.dae.scene=new Y(am.getAttribute("url"));break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseLibVisualScene=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"visual_scene":this._parseVisualScene(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseVisualScene=function(aj){var an,am,al,ai,ak;am=new E;am.id=aj.getAttribute("id");this._addUrlTarget(am,this.dae.libVisualScenes,true);ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){an=ak[al];if(an.nodeType===1){switch(an.nodeName){case"node":this._parseSceneNode(am,an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseSceneNode=function(ak,aj){var ao,al,an,ai,am;al=new U;al.id=aj.getAttribute("id");al.sid=aj.getAttribute("sid");al.name=aj.getAttribute("name");al.type=aj.getAttribute("type");al.layer=aj.getAttribute("layer");al.parent=ak;ak.children.push(al);this._addUrlTarget(al,null,false);this._addSidTarget(al,ak);am=aj.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"instance_geometry":this._parseInstanceGeometry(al,ao);break;case"instance_controller":this._parseInstanceController(al,ao);break;case"instance_light":this._parseInstanceLight(al,ao);break;case"instance_camera":this._parseInstanceCamera(al,ao);break;case"matrix":case"rotate":case"translate":case"scale":this._parseTransformElement(al,ao);break;case"node":this._parseSceneNode(al,ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseInstanceGeometry=function(ak,aj){var ao,an,am,ai,al;an=new J();an.geometry=new Y(aj.getAttribute("url"));an.sid=aj.getAttribute("sid");ak.geometries.push(an);this._addSidTarget(an,ak);al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"bind_material":this._parseBindMaterial(an,ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseInstanceController=function(al,ak){var ao,aj,an,ai,am;aj=new u();aj.controller=new Y(ak.getAttribute("url"));aj.sid=ak.getAttribute("sid");aj.name=ak.getAttribute("name");al.controllers.push(aj);this._addSidTarget(aj,al);am=ak.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"skeleton":aj.skeletons.push(new Y(ao.textContent));break;case"bind_material":this._parseBindMaterial(aj,ao);break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseBindMaterial=function(ak,aj){var an,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"technique_common":this._parseBindMaterialTechnique(ak,an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseBindMaterialTechnique=function(ak,aj){var an,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"instance_material":this._parseInstanceMaterial(ak,an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseInstanceMaterial=function(ar,aj){var ai,ak,ap,ao,at,an,al,aq,am;ao=new p;ao.symbol=aj.getAttribute("symbol");ao.material=new Y(aj.getAttribute("target"));ar.materials.push(ao);this._addSidTarget(ao,ar);am=aj.childNodes;for(al=0,aq=am.length;al<aq;al++){ai=am[al];if(ai.nodeType===1){switch(ai.nodeName){case"bind_vertex_input":at=ai.getAttribute("semantic");ak=ai.getAttribute("input_semantic");ap=ai.getAttribute("input_set");if(ap!=null){ap=parseInt(ap,10)}ao.vertexInputs[at]={inputSemantic:ak,inputSet:ap};break;case"bind":at=ai.getAttribute("semantic");an=new z(null,ai.getAttribute("target"));ao.params[at]={target:an};break;default:this._reportUnexpectedChild(aj,ai)}}}};ah.prototype._parseTransformElement=function(ak,aj){var al,ai;ai=new m;ai.sid=aj.getAttribute("sid");ai.type=aj.nodeName;ai.node=ak;ak.transformations.push(ai);this._addSidTarget(ai,ak);this.dae.animationTargets.push(ai);ai.data=L(aj.textContent);al=0;switch(ai.type){case"matrix":al=16;break;case"rotate":al=4;break;case"translate":al=3;break;case"scale":al=3;break;case"skew":al=7;break;case"lookat":al=9;break;default:this._log("Unknown transformation type "+ai.type+".",aa.messageError)}if(ai.data.length!==al){this._log("Wrong number of elements for transformation type '"+ai.type+"': expected "+al+", found "+ai.data.length,aa.messageError)}};ah.prototype._parseInstanceLight=function(al,ak){var ao,aj,an,ai,am;aj=new B();aj.light=new Y(ak.getAttribute("url"));aj.sid=ak.getAttribute("sid");aj.name=ak.getAttribute("name");al.lights.push(aj);this._addSidTarget(aj,al);am=ak.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"extra":this._reportUnhandledExtra(ak,ao);break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseInstanceCamera=function(al,ak){var aj,ao,an,ai,am;aj=new Z();aj.camera=new Y(ak.getAttribute("url"));aj.sid=ak.getAttribute("sid");aj.name=ak.getAttribute("name");al.cameras.push(aj);this._addSidTarget(aj,al);am=ak.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"extra":this._reportUnhandledExtra(ak,ao);break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseLibEffect=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"effect":this._parseEffect(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseEffect=function(ak){var an,aj,am,ai,al;aj=new d;aj.id=ak.getAttribute("id");this._addUrlTarget(aj,this.dae.libEffects,true);al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"profile_COMMON":this._parseEffectProfileCommon(aj,an);break;case"profile":this._log("Skipped non-common effect profile for effect "+aj.id+".",aa.messageWarning);break;case"extra":break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseEffectProfileCommon=function(ak,aj){var an,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"newparam":this._parseEffectNewparam(ak,an);break;case"technique":this._parseEffectTechnique(ak,an);break;case"extra":this._parseTechniqueExtra(ak.technique,"COMMON",an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseEffectNewparam=function(al,ak){var ao,aj,an,ai,am;aj=ak.getAttribute("sid");am=ak.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"surface":this._parseEffectSurface(al,aj,ao);break;case"sampler2D":this._parseEffectSampler(al,aj,ao);break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseEffectSurface=function(am,ak,al){var ap,ai,ao,aj,an;ai=new ab;ai.type=al.getAttribute("type");ai.sid=ak;this._addFxTarget(ai,am);an=al.childNodes;for(ao=0,aj=an.length;ao<aj;ao++){ap=an[ao];if(ap.nodeType===1){switch(ap.nodeName){case"init_from":ai.initFrom=new Y(ap.textContent);break;case"format":ai.format=ap.textContent;break;case"size":ai.size=L(ap.textContent);break;case"viewport_ratio":ai.viewportRatio=L(ap.textContent);break;case"mip_levels":ai.mipLevels=parseInt(ap.textContent,10);break;case"mipmap_generate":ai.mipmapGenerate=ap.textContent;break;default:this._reportUnexpectedChild(al,ap)}}}};ah.prototype._parseEffectSampler=function(am,aj,al){var ap,ak,ao,ai,an;ak=new a;ak.sid=aj;this._addFxTarget(ak,am);an=al.childNodes;for(ao=0,ai=an.length;ao<ai;ao++){ap=an[ao];if(ap.nodeType===1){switch(ap.nodeName){case"source":ak.surface=new b(ap.textContent,am);break;case"instance_image":ak.image=new Y(ap.getAttribute("url"));break;case"wrap_s":ak.wrapS=ap.textContent;break;case"wrap_t":ak.wrapT=ap.textContent;break;case"minfilter":ak.minfilter=ap.textContent;break;case"magfilter":ak.magfilter=ap.textContent;break;case"border_color":ak.borderColor=L(ap.textContent);break;case"mipmap_maxlevel":ak.mipmapMaxLevel=parseInt(ap.textContent,10);break;case"mipmap_bias":ak.mipmapBias=parseFloat(ap.textContent);break;default:this._reportUnexpectedChild(al,ap)}}}};ah.prototype._parseEffectTechnique=function(ak,aj){var ao,an,am,ai,al;an=new x;an.sid=aj.getAttribute("sid");this._addFxTarget(an,ak);ak.technique=an;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"blinn":case"phong":case"lambert":case"constant":an.shading=ao.nodeName;this._parseTechniqueParam(an,"COMMON",ao);break;case"extra":this._parseTechniqueExtra(an,"COMMON",ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseTechniqueParam=function(an,ak,aj){var ao,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"newparam":this._parseEffectNewparam(an,ao);break;case"emission":case"ambient":case"diffuse":case"specular":case"reflective":this._parseEffectColorOrTexture(an,ao);break;case"shininess":case"reflectivity":case"transparency":case"index_of_refraction":an[ao.nodeName]=parseFloat(ao.childNodes[1].textContent);break;case"transparent":this._parseEffectColorOrTexture(an,ao);an.transparent.opaque=ao.getAttribute("opaque");break;case"bump":this._parseEffectColorOrTexture(an,ao);an.bump.bumptype=ao.getAttribute("bumptype");break;case"double_sided":an.doubleSided=parseInt(ao.textContent,10)===1?true:false;break;default:if(ak==="COMMON"){this._reportUnexpectedChild(aj,ao)}}}}};ah.prototype._parseTechniqueExtra=function(an,ak,aj){var ao,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"technique":ak=ao.getAttribute("profile");this._parseTechniqueParam(an,ak,ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseEffectColorOrTexture=function(aj,al){var ak,ap,ai,ao,am,aq,an;ai=al.nodeName;ap=aj[ai];if(!(ap!=null)){ap=new ad();aj[ai]=ap}an=al.childNodes;for(am=0,aq=an.length;am<aq;am++){ak=an[am];if(ak.nodeType===1){switch(ak.nodeName){case"color":ap.color=D(ak.textContent);break;case"texture":ao=ak.getAttribute("texture");ap.textureSampler=new b(ao,aj);ap.texcoord=ak.getAttribute("texcoord");break;default:this._reportUnexpectedChild(al,ak)}}}};ah.prototype._parseLibMaterial=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"material":this._parseMaterial(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseMaterial=function(ak){var an,aj,am,ai,al;aj=new G;aj.id=ak.getAttribute("id");aj.name=ak.getAttribute("name");this._addUrlTarget(aj,this.dae.libMaterials,true);al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"instance_effect":aj.effect=new Y(an.getAttribute("url"));break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseLibGeometry=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"geometry":this._parseGeometry(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseGeometry=function(aj){var an,am,al,ai,ak;am=new e();am.id=aj.getAttribute("id");am.name=aj.getAttribute("name");this._addUrlTarget(am,this.dae.libGeometries,true);ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){an=ak[al];if(an.nodeType===1){switch(an.nodeName){case"mesh":this._parseMesh(am,an);break;case"convex_mesh":case"spline":this._log("Geometry type "+an.nodeName+" not supported.",aa.messageError);break;case"extra":this._parseGeometryExtra(am,an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseMesh=function(am,aj){var an,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){an=ak[al];if(an.nodeType===1){switch(an.nodeName){case"source":this._parseSource(am,an);break;case"vertices":this._parseVertices(am,an);break;case"triangles":case"polylist":case"polygons":this._parseTriangles(am,an);break;case"lines":case"linestrips":case"trifans":case"tristrips":this._log("Geometry primitive type "+an.nodeName+" not supported.",aa.messageError);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseGeometryExtra=function(an,ak){var ao,aj,am,ai,al;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"technique":aj=ao.getAttribute("profile");this._parseGeometryExtraTechnique(an,aj,ao);break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseGeometryExtraTechnique=function(an,ak,aj){var ao,am,ai,al;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"double_sided":an.doubleSided=aj.textContent==="1"}}}};ah.prototype._parseSource=function(ak,aj){var ao,an,am,ai,al;an=new I;an.id=aj.getAttribute("id");an.name=aj.getAttribute("name");this._addUrlTarget(an,ak.sources,true);al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"bool_array":an.sourceId=ao.getAttribute("id");an.data=A(ao.textContent);break;case"float_array":an.sourceId=ao.getAttribute("id");an.data=L(ao.textContent);break;case"int_array":an.sourceId=ao.getAttribute("id");an.data=l(ao.textContent);break;case"IDREF_array":case"Name_array":an.sourceId=ao.getAttribute("id");an.data=N(ao.textContent);break;case"technique_common":this._parseSourceTechniqueCommon(an,ao);break;case"technique":break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseVertices=function(an,ak){var ao,aj,am,ai,al;aj=new R;aj.id=ak.getAttribute("id");aj.name=ak.getAttribute("name");this._addUrlTarget(aj,null,true);an.vertices=aj;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"input":aj.inputs.push(this._parseInput(ao));break;default:this._reportUnexpectedChild(ak,ao)}}}};ah.prototype._parseTriangles=function(an,aj){var ao,am,al,ai,ak;am=new w;am.name=aj.getAttribute("name");am.material=aj.getAttribute("material");am.count=this._getAttributeAsInt(aj,"count");am.type=aj.nodeName;an.triangles.push(am);ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){ao=ak[al];if(ao.nodeType===1){switch(ao.nodeName){case"input":am.inputs.push(this._parseInput(ao));break;case"vcount":am.vcount=l(ao.textContent);break;case"p":am.indices=l(ao.textContent);break;default:this._reportUnexpectedChild(aj,ao)}}}return am};ah.prototype._parseSourceTechniqueCommon=function(am,aj){var an,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){an=ak[al];if(an.nodeType===1){switch(an.nodeName){case"accessor":this._parseAccessor(am,an);break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseAccessor=function(ai,al){var ak,aj,aq,ao,am,ap,an;aq=al.getAttribute("source");ai.count=al.getAttribute("count");ai.stride=this._getAttributeAsInt(al,"stride",1);if(aq!=="#"+ai.sourceId){this._log("Non-local sources not supported, source data will be empty",aa.messageError)}an=al.childNodes;for(am=0,ap=an.length;am<ap;am++){ak=an[am];if(ak.nodeType===1){switch(ak.nodeName){case"param":aj=ak.getAttribute("name");ao=ak.getAttribute("type");ai.params[aj]=ao;break;default:this._reportUnexpectedChild(al,ak)}}}};ah.prototype._parseInput=function(aj){var ai;ai=new K;ai.semantic=aj.getAttribute("semantic");ai.source=new Y(aj.getAttribute("source"));ai.offset=this._getAttributeAsInt(aj,"offset");ai.set=this._getAttributeAsInt(aj,"set");return ai};ah.prototype._parseLibImage=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"image":this._parseImage(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseImage=function(aj){var an,am,al,ai,ak;am=new O;am.id=aj.getAttribute("id");this._addUrlTarget(am,this.dae.libImages,true);ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){an=ak[al];if(an.nodeType===1){switch(an.nodeName){case"init_from":am.initFrom=an.textContent;break;default:this._reportUnexpectedChild(aj,an)}}}};ah.prototype._parseLibController=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"controller":this._parseController(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseController=function(ak){var an,aj,am,ai,al;aj=new Q;aj.id=ak.getAttribute("id");aj.name=ak.getAttribute("name");this._addUrlTarget(aj,this.dae.libControllers,true);al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"skin":this._parseSkin(aj,an);break;case"morph":this._parseMorph(aj,an);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseMorph=function(aj,ai){this._log("Morph controllers not implemented",aa.messageError)};ah.prototype._parseSkin=function(ak,aj){var ao,an,am,ai,al;an=new t;an.source=new Y(aj.getAttribute("source"));if((ak.skin!=null)||(ak.morph!=null)){this._log("Controller already has a skin or morph",aa.messageError)}ak.skin=an;al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"bind_shape_matrix":this._parseBindShapeMatrix(an,ao);break;case"source":this._parseSource(an,ao);break;case"joints":this._parseJoints(an,ao);break;case"vertex_weights":this._parseVertexWeights(an,ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseBindShapeMatrix=function(aj,ai){aj.bindShapeMatrix=L(ai.textContent)};ah.prototype._parseJoints=function(at,al){var ak,ar,ap,ai,an,am,aq,aj,ao;ai=new V;if(at.joints!=null){this._log("Skin already has a joints array",aa.messageError)}at.joints=ai;ap=[];ao=al.childNodes;for(an=0,aq=ao.length;an<aq;an++){ak=ao[an];if(ak.nodeType===1){switch(ak.nodeName){case"input":ap.push(this._parseInput(ak));break;default:this._reportUnexpectedChild(al,ak)}}}for(am=0,aj=ap.length;am<aj;am++){ar=ap[am];switch(ar.semantic){case"JOINT":ai.joints=ar;break;case"INV_BIND_MATRIX":ai.invBindMatrices=ar;break;default:this._log("Unknown joints input semantic "+ar.semantic,aa.messageError)}}};ah.prototype._parseVertexWeights=function(at,ak){var aj,ar,ao,aq,am,al,ap,ai,an;aq=new ac;aq.count=parseInt(ak.getAttribute("count"),10);if(at.vertexWeights!=null){this._log("Skin already has a vertex weight array",aa.messageError)}at.vertexWeights=aq;ao=[];an=ak.childNodes;for(am=0,ap=an.length;am<ap;am++){aj=an[am];if(aj.nodeType===1){switch(aj.nodeName){case"input":ao.push(this._parseInput(aj));break;case"vcount":aq.vcount=l(aj.textContent);break;case"v":aq.v=l(aj.textContent);break;default:this._reportUnexpectedChild(ak,aj)}}}for(al=0,ai=ao.length;al<ai;al++){ar=ao[al];switch(ar.semantic){case"JOINT":aq.joints=ar;break;case"WEIGHT":aq.weights=ar;break;default:this._log("Unknown vertex weight input semantic "+ar.semantic,aa.messageError)}}};ah.prototype._parseLibAnimation=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"animation":this._parseAnimation(null,am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseAnimation=function(ak,aj){var an,ao,am,ai,al;an=new k;an.id=aj.getAttribute("id");an.name=aj.getAttribute("name");an.parent=ak;if(ak!=null){an.rootId=ak.rootId;an.rootName=ak.rootName}else{an.rootId=an.id;an.rootName=an.name}this._addUrlTarget(an,(ak!=null?ak.animations:void 0)||this.dae.libAnimations,false);al=aj.childNodes;for(am=0,ai=al.length;am<ai;am++){ao=al[am];if(ao.nodeType===1){switch(ao.nodeName){case"animation":this._parseAnimation(an,ao);break;case"source":this._parseSource(an,ao);break;case"sampler":this._parseSampler(an,ao);break;case"channel":this._parseChannel(an,ao);break;default:this._reportUnexpectedChild(aj,ao)}}}};ah.prototype._parseSampler=function(at,ak){var aj,ar,ao,ap,am,al,aq,ai,an;ap=new g;ap.id=ak.getAttribute("id");if(ap.id!=null){this._addUrlTarget(ap,at.samplers,false)}ao=[];an=ak.childNodes;for(am=0,aq=an.length;am<aq;am++){aj=an[am];if(aj.nodeType===1){switch(aj.nodeName){case"input":ao.push(this._parseInput(aj));break;default:this._reportUnexpectedChild(ak,aj)}}}for(al=0,ai=ao.length;al<ai;al++){ar=ao[al];switch(ar.semantic){case"INPUT":ap.input=ar;break;case"OUTPUT":ap.outputs.push(ar);break;case"INTERPOLATION":ap.interpolation=ar;break;case"IN_TANGENT":ap.inTangents.push(ar);break;case"OUT_TANGENT":ap.outTangents.push(ar);break;default:this._log("Unknown sampler input semantic "+ar.semantic,aa.messageError)}}};ah.prototype._parseChannel=function(ak,aj){var al,ao,an,ai,am;al=new af;al.source=new Y(aj.getAttribute("source"));al.target=new z(ak.id,aj.getAttribute("target"));ak.channels.push(al);al.animation=ak;am=aj.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){this._reportUnexpectedChild(aj,ao)}}};ah.prototype._parseLibLight=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"light":this._parseLight(am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseLight=function(ak){var an,aj,am,ai,al;aj=new h();aj.id=ak.getAttribute("id");aj.name=ak.getAttribute("name");if(aj.id!=null){this._addUrlTarget(aj,this.dae.libLights,true)}al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"technique_common":this._parseLightTechniqueCommon(an,aj);break;case"extra":this._reportUnhandledExtra(ak,an);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseLightTechniqueCommon=function(ak,aj){var an,am,ai,al;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"ambient":this._parseLightParams(an,"COMMON",aj);break;case"directional":this._parseLightParams(an,"COMMON",aj);break;case"point":this._parseLightParams(an,"COMMON",aj);break;case"spot":this._parseLightParams(an,"COMMON",aj);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseLightParams=function(al,ak,aj){var ao,an,ai,am;aj.type=al.nodeName;am=al.childNodes;for(an=0,ai=am.length;an<ai;an++){ao=am[an];if(ao.nodeType===1){switch(ao.nodeName){case"color":this._parseLightColor(ao,ak,aj);break;case"constant_attenuation":this._parseLightParam(ao,ak,aj);break;case"linear_attenuation":this._parseLightParam(ao,ak,aj);break;case"quadratic_attenuation":this._parseLightParam(ao,ak,aj);break;case"falloff_angle":this._parseLightParam(ao,ak,aj);break;case"falloff_exponent":this._parseLightParam(ao,ak,aj);break;default:this._reportUnexpectedChild(al,ao)}}}};ah.prototype._parseLightColor=function(ak,aj,ai){ai.color=L(ak.textContent)};ah.prototype._parseLightParam=function(ak,aj,ai){var al;al=new i();al.sid=ak.getAttribute("sid");al.name=ak.nodeName;ai.params[al.name]=al;this._addSidTarget(al,ai);al.value=parseFloat(ak.textContent)};ah.prototype._parseLibCamera=function(aj){var am,al,ai,ak;ak=aj.childNodes;for(al=0,ai=ak.length;al<ai;al++){am=ak[al];if(am.nodeType===1){switch(am.nodeName){case"camera":this._parseCamera(am);break;case"extra":this._reportUnhandledExtra(aj,am);break;default:this._reportUnexpectedChild(aj,am)}}}};ah.prototype._parseCamera=function(ak){var aj,an,am,ai,al;aj=new F;aj.id=ak.getAttribute("id");if(aj.id!=null){this._addUrlTarget(aj,this.dae.libCameras,true)}aj.name=ak.getAttribute("name");al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"asset":this._reportUnhandledExtra(ak,an);break;case"optics":this._parseCameraOptics(an,aj);break;case"imager":this._reportUnhandledExtra(ak,an);break;case"extra":this._reportUnhandledExtra(ak,an);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseCameraOptics=function(ak,aj){var an,am,ai,al;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"technique_common":this._parseCameraTechniqueCommon(an,aj);break;case"technique":this._reportUnhandledExtra(ak,an);break;case"extra":this._reportUnhandledExtra(ak,an);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseCameraTechniqueCommon=function(ak,aj){var an,am,ai,al;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"orthographic":this._parseCameraParams(an,aj);break;case"perspective":this._parseCameraParams(an,aj);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseCameraParams=function(ak,aj){var an,am,ai,al;aj.type=ak.nodeName;al=ak.childNodes;for(am=0,ai=al.length;am<ai;am++){an=al[am];if(an.nodeType===1){switch(an.nodeName){case"xmag":this._parseCameraParam(an,aj);break;case"ymag":this._parseCameraParam(an,aj);break;case"xfov":this._parseCameraParam(an,aj);break;case"yfov":this._parseCameraParam(an,aj);break;case"aspect_ratio":this._parseCameraParam(an,aj);break;case"znear":this._parseCameraParam(an,aj);break;case"zfar":this._parseCameraParam(an,aj);break;case"extra":this._reportUnhandledExtra(ak,an);break;default:this._reportUnexpectedChild(ak,an)}}}};ah.prototype._parseCameraParam=function(aj,ai){var ak;ak=new S();ak.sid=aj.getAttribute("sid");ak.name=aj.nodeName;ai.params[ak.name]=ak;this._addSidTarget(ak,ai);ak.value=parseFloat(aj.textContent)};ah.prototype._linkAnimations=function(){var an,ao,am,ak,aj,ai,al,ap;al=this.dae.animationTargets;for(am=0,aj=al.length;am<aj;am++){ao=al[am];ao.initAnimationTarget()}ap=this.dae.libAnimations;for(ak=0,ai=ap.length;ak<ai;ak++){an=ap[ak];this._linkAnimationChannels(an)}};ah.prototype._linkAnimationChannels=function(ap){var au,aj,ak,al,ax,av,at,ay,aq,ao,aw,ai,ar,an,am;ar=ap.channels;for(aq=0,aw=ar.length;aq<aw;aq++){au=ar[aq];at=this._getLinkTarget(au.target,o);if(!(at!=null)){this._log("Animation channel has an invalid target '"+au.target.url+"', animation ignored",aa.messageWarning);continue}av=this._getLinkTarget(au.source,g);if(!(av!=null)){this._log("Animation channel has an invalid sampler '"+au.source.url+"', animation ignored",aa.messageWarning);continue}ak=this._getLinkTarget((an=av.input)!=null?an.source:void 0);if(!(ak!=null)){this._log("Animation channel has no input data, animation ignored",aa.messageWarning);continue}if(av.outputs.length===0){this._log("Animation channel has no output, animation ignored",aa.messageWarning);continue}if(av.outputs.length>1){this._log("Animation channel has more than one output, using only the first output",aa.messageWarning)}al=av.outputs[0];ax=this._getLinkTarget(al!=null?al.source:void 0);if(!(ax!=null)){this._log("Animation channel has no output data, animation ignored",aa.messageWarning);continue}ay=new r;ay.outputData=ax.data;ay.inputData=ak.data;ay.stride=ax.stride;ay.animation=ap;if(au.target.dotSyntax){ay.semantic=au.target.member;ay.count=1;switch(ay.semantic){case"X":ay.offset=0;break;case"Y":ay.offset=1;break;case"Z":ay.offset=2;break;case"W":ay.offset=3;break;case"R":ay.offset=0;break;case"G":ay.offset=1;break;case"B":ay.offset=2;break;case"U":ay.offset=0;break;case"V":ay.offset=1;break;case"S":ay.offset=0;break;case"T":ay.offset=1;break;case"P":ay.offset=2;break;case"Q":ay.offset=3;break;case"ANGLE":ay.offset=3;break;default:this._log("Unknown semantic for '"+targetLink.url+"', animation ignored",aa.messageWarning);continue}}else{if(au.target.arrSyntax){switch(targetLink.indices.length){case 1:ay.offset=targetLink.indices[0];break;case 2:ay.offset=targetLink.indices[0]*at.animTarget.dataRows+targetLink.indices[1];break;default:this._log("Invalid number of indices for '"+targetLink.url+"', animation ignored",aa.messageWarning);continue}ay.count=1}else{ay.offset=0;ay.count=at.animTarget.dataColumns*at.animTarget.dataRows}}at.animTarget.channels.push(ay)}am=ap.animations;for(ao=0,ai=am.length;ao<ai;ao++){aj=am[ao];this._linkAnimationChannels(aj)}};ah.prototype._createSceneGraph=function(){var an,al,am,ak,ai,aj;al=this._getLinkTarget(this.dae.scene,E);if(!(al!=null)){return}am=new THREE.Object3D();this.threejs.scene=am;aj=al.children;for(ak=0,ai=aj.length;ak<ai;ak++){an=aj[ak];this._createSceneGraphNode(an,am)}this.scene=am};ah.prototype._setNodeTransformation=function(ai,aj){ai.getTransformMatrix(aj.matrix);aj.matrix.decompose(aj.position,aj.quaternion,aj.scale);aj.rotation.setEulerFromQuaternion(aj.quaternion)};ah.prototype._createSceneGraphNode=function(au,am){var av,ao,az,aB,aL,ay,aF,aJ,aC,aA,aw,ar,ap,al,aj,aI,aK,aH,aG,aE,aD,ai,aM,ax,at,aq,an,ak;aJ=[];ax=au.geometries;for(ar=0,aI=ax.length;ar<aI;ar++){aB=ax[ar];aA=this._createStaticMesh(aB);if(aA!=null){aA.name=au.name!=null?au.name:"";aJ.push(aA)}}at=au.controllers;for(ap=0,aK=at.length;ap<aK;ap++){az=at[ap];aA=this._createAnimatedMesh(az);if(aA!=null){aA.name=au.name!=null?au.name:"";aJ.push(aA)}}aq=au.lights;for(al=0,aH=aq.length;al<aH;al++){aL=aq[al];aC=this._createLight(aL);if(aC!=null){aC.name=au.name!=null?au.name:"";aJ.push(aC)}}an=au.cameras;for(aj=0,aG=an.length;aj<aG;aj++){av=an[aj];ay=this._createCamera(av);if(ay!=null){ay.name=au.name!=null?au.name:"";aJ.push(ay)}}if(aJ.length>1){aw=new THREE.Object3D();for(ai=0,aE=aJ.length;ai<aE;ai++){aF=aJ[ai];if(aF!=null){aw.add(aF)}}am.add(aw)}else{if(aJ.length===1){aw=aJ[0];am.add(aw)}else{if(aJ.length===0){if(au.type!=="JOINT"){this._log("Collada node "+au.name+" did not produce any threejs nodes",aa.messageWarning)}aw=new THREE.Object3D();am.add(aw)}}}this._setNodeTransformation(au,aw);ak=au.children;for(aM=0,aD=ak.length;aM<aD;aM++){ao=ak[aM];this._createSceneGraphNode(ao,aw)}};ah.prototype._createLight=function(aw){var al,av,an,ao,at,ar,au,ap,aq,am,ak,aj,ai;ap=this._getLinkTarget(aw.light,h);if(!(ap!=null)){this._log("Light instance has no light, light ignored",aa.messageWarning);return null}ao=ap.color;at=(ao[0]*255)<<16^(ao[1]*255)<<8^(ao[2]*255)<<0;al=(aq=ap.params.constant_attenuation)!=null?aq.value:void 0;av=(am=ap.params.linear_attenuation)!=null?am.value:void 0;an=(ak=ap.params.quadratic_attenuation)!=null?ak.value:void 0;ar=(aj=ap.params.falloff_angle)!=null?aj.value:void 0;au=(ai=ap.params.falloff_exponent)!=null?ai.value:void 0;switch(ap.type){case"ambient":ap=new THREE.AmbientLight(at);break;case"directional":ap=new THREE.DirectionalLight(at,1);break;case"point":ap=new THREE.PointLight(at,al,av);break;case"spot":ap=new THREE.SpotLight(at,al,av,ar,au);break;default:this._log("Unknown light type "+aw.type+", light ignored.",aa.messageError)}return ap};ah.prototype._createCamera=function(ax){var ai,aw,ap,ar,al,an,au,ay,av,at,aq,ao,am,ak,aj;aw=this._getLinkTarget(ax.camera,F);if(!(aw!=null)){this._log("Camera instance has no camera, camera ignored",aa.messageWarning);return null}ar=(av=aw.params.xmag)!=null?av.value:void 0;an=(at=aw.params.ymag)!=null?at.value:void 0;ap=(aq=aw.params.xfov)!=null?aq.value:void 0;al=(ao=aw.params.yfov)!=null?ao.value:void 0;ai=(am=aw.params.aspect_ratio)!=null?am.value:void 0;ay=(ak=aw.params.znear)!=null?ak.value:void 0;au=(aj=aw.params.zfar)!=null?aj.value:void 0;switch(aw.type){case"orthographic":if((ar!=null)&&(an!=null)){ai=ar/an}else{if((an!=null)&&(ai!=null)){ar=an*ai}else{if((ar!=null)&&(ai!=null)){an=ar/ai}else{if(ar!=null){ai=1;an=ar}else{if(an!=null){ai=1;ar=an}else{this._log("Not enough field of view parameters for an orthographic camera.",aa.messageError)}}}}}aw=new THREE.OrthographicCamera(-ar,+ar,-an,+an,ay,au);break;case"perspective":if((ap!=null)&&(al!=null)){ai=ap/al}else{if((al!=null)&&(ai!=null)){ap=al*ai}else{if((ap!=null)&&(ai!=null)){al=ap/ai}else{if(ap!=null){ai=1;al=ap}else{if(al!=null){ai=1;ap=al}else{this._log("Not enough field of view parameters for a perspective camera.",aa.messageError)}}}}}aw=new THREE.PerspectiveCamera(al,ai,ay,au);break;default:this._log("Unknown camera type "+ax.type+", camera ignored.",aa.messageError)}return aw};ah.prototype._createStaticMesh=function(aj){var ai,an,ak,am,al;ai=this._getLinkTarget(aj.geometry,e);if(!(ai!=null)){this._log("Geometry instance has no geometry, mesh ignored",aa.messageWarning);return null}al=this._createGeometryAndMaterial(ai,aj.materials),ak=al[0],am=al[1];an=new THREE.Mesh(ak,am);return an};ah.prototype._createGeometryAndMaterial=function(aq,al){var am,an,ai,ap,aj,ao,ak;ap=this._createMaterials(al);an=this._createGeometry(aq,ap);ai=null;if(ap.materials.length>1){ai=new THREE.MeshFaceMaterial();ak=ap.materials;for(aj=0,ao=ak.length;aj<ao;aj++){am=ak[aj];ai.materials.push(am)}}else{ai=ap.materials[0]}return[an,ai]};ah.prototype._createAnimatedMesh=function(ai,aj){aj=this._getLinkTarget(ai.controller,Q);if(aj.skin!=null){return this._createSkinMesh(ai,aj)}if(aj.morph!=null){return this._createMorphMesh(ai,aj)}this._log("Controller has neither a skin nor a morph, can not create a mesh",aa.messageError);return null};ah.prototype._createSkinMesh=function(aB,aC){var ay,aI,aD,aF,av,aP,aH,au,az,al,aO,aw,aE,ax,aN,aG,ar,ap,an,ak,aL,aM,aK,aJ,aA,at,aq,ao,am,aj,ai;av=aC.skin;if(!(av!=null)||!(av instanceof t)){this._log("Controller for a skinned mesh has no skin, mesh ignored",aa.messageError);return null}aP=this._getLinkTarget(av.source);if(!(aP!=null)){this._log("Skin for a skinned mesh has no geometry, mesh ignored",aa.messageError);return null}if(!this._options.useAnimations){aA=this._createGeometryAndMaterial(aP,aB.materials),aN=aA[0],aG=aA[1];return new THREE.Mesh(aN,aG)}ax=[];at=aB.skeletons;for(ar=0,aL=at.length;ar<aL;ar++){aE=at[ar];aw=this._getLinkTarget(aE,U);if(!(aw!=null)){this._log("Controller instance for a skinned mesh uses unknown skeleton "+aw+", skeleton ignored",aa.messageError);continue}ax.push(aw)}if(ax.length===0){this._log("Controller instance for a skinned mesh has no skeleton, mesh ignored",aa.messageError);return null}if(!(av.joints!=null)){this._log("Skin has no joints, mesh ignored",aa.messageError);return null}aF=this._getLinkTarget((aq=av.joints.joints)!=null?aq.source:void 0,I);if(!(aF!=null)||!(aF.data!=null)){this._log("Skin has no joints source, mesh ignored",aa.messageError);return null}aD=this._getLinkTarget((ao=av.joints.invBindMatrices)!=null?ao.source:void 0,I);if(!(aD!=null)||!(aD.data!=null)){this._log("Skin has no inverse bind matrix source, mesh ignored",aa.messageError);return null}if(aF.data.length*16!==aD.data.length){this._log("Skin has an inconsistent length of joint data sources, mesh ignored",aa.messageError);return null}aI=[];am=aF.data;for(ap=0,aM=am.length;ap<aM;ap++){az=am[ap];au=this._findJointNode(az,ax);if(!(au!=null)){this._log("Joint "+az+" not found for skin with skeletons "+((ax.map(function(aQ){return aQ.id})).join(", "))+", mesh ignored",aa.messageError);return null}ay=this._createBone(au,az,aI);X(aD.data,ay.index*16,ay.invBindMatrix)}if(this._options.verboseMessages){this._log("Skin contains "+aI.length+" bones",aa.messageInfo)}aH=0;while(aH<aI.length){ay=aI[aH];aH=aH+1;for(an=0,aK=aI.length;an<aK;an++){aO=aI[an];if(ay.node.parent===aO.node){ay.parent=aO;break}}if((ay.node.parent!=null)&&ay.node.parent instanceof U&&!(ay.parent!=null)){ay.parent=this._createBone(ay.node.parent,"",aI)}}if(this._options.verboseMessages){this._log("Skeleton contains "+aI.length+" bones",aa.messageInfo)}if(!(av.vertexWeights!=null)){this._log("Skin has no vertex weight data, mesh ignored",aa.messageError);return null}if(av.vertexWeights.joints.source.url!==av.joints.joints.source.url){this._log("Skin uses different data sources for joints in <joints> and <vertex_weights>, this is not supported by this loader, mesh ignored",aa.messageError);return null}aj=this._createGeometryAndMaterial(aP,aB.materials),aN=aj[0],aG=aj[1];if(this._options.convertSkinsToMorphs){if(this._addSkinMorphTargets(aN,av,aI,aG)){return new THREE.MorphAnimMesh(aN,aG)}else{return new THREE.Mesh(aN,aG)}}else{if(this._addSkinBones(aN,av,aI,aG)){al=new THREE.SkinnedMesh(aN,aG);al.boneInverses=[];ai=aN.bones;for(ak=0,aJ=ai.length;ak<aJ;ak++){ay=ai[ak];al.boneInverses.push(ay.inverse)}return al}else{return new THREE.Mesh(aN,aG)}}return null};ah.prototype._findJointNode=function(al,an){var aj,am,ak,ai;aj=null;for(ak=0,ai=an.length;ak<ai;ak++){am=an[ak];aj=this._findSidTarget(am,al);if(aj!=null){break}}if(aj instanceof U){return aj}else{return null}};ah.prototype._createBone=function(ap,ao,ai){var an,ak,am,aj,al;an=new M;an.sid=ao;an.node=ap;al=ap.transformations;for(am=0,aj=al.length;am<aj;am++){ak=al[am];if(ak.animTarget.channels.length>0){an.isAnimated=true;break}}an.matrix=new THREE.Matrix4;ap.getTransformMatrix(an.matrix);an.index=ai.length;ai.push(an);return an};ah.prototype._addSkinMorphTargets=function(ak,aV,aO,aB){var aM,az,ap,aK,aF,ay,aq,aS,aQ,al,aE,ai,aN,aI,ar,ax,aU,aj,aA,aD,aL,aC,aG,av,ao,aH,aP,aT,aR,aw,an,am,aJ,au,at;aI=this._prepareAnimations(aO);if(!aI>0){return null}aE=ak.vertices;aU=aE.length;aC=aV.vertexWeights.v;aG=aV.vertexWeights.vcount;aL=this._getLinkTarget(aV.vertexWeights.joints.source);ao=this._getLinkTarget(aV.vertexWeights.weights.source);aD=aL!=null?aL.data:void 0;av=ao!=null?ao.data:void 0;if(!(av!=null)){this._log("Skin has no weights data, no morph targets added for mesh",aa.messageError);return null}aM=new THREE.Matrix4;if(aV.bindShapeMatrix!=null){aM=W(aV.bindShapeMatrix,0)}aN=new THREE.Vector3;aq=true;ay=true;for(aS=0,aJ=aI-1;aS<=aJ;aS+=1){this._updateSkinMatrices(aO,aM,aS);aj=[];for(aT=0,aw=aE.length;aT<aw;aT++){ai=aE[aT];aj.push(new THREE.Vector3())}aA=0;for(aS=0,an=aj.length;aS<an;aS++){ax=aj[aS];al=aE[aS];aP=aG[aS];ar=0;for(aH=0,au=aP-1;aH<=au;aH+=1){ap=aC[aA];aF=aC[aA+1];aA+=2;aK=av[aF];ar+=aK;if(ap>=0){az=aO[ap];aN.copy(al);aN.applyMatrix4(az.skinMatrix);aN.multiplyScalar(aK);ax.add(aN)}else{aN.copy(al);aN.applyMatrix4(aM);aN.multiplyScalar(aK);ax.add(aN)}}if(aP===0){ax.copy(al);if(aq){this._log("Skinned vertex not influenced by any bone, some vertices will be unskinned",aa.messageWarning);aq=false}}else{if(!((0.01<ar&&ar<1000000))){ax.copy(al);if(ay){this._log("Zero or infinite total weight for skinned vertex, some vertices will be unskinned",aa.messageWarning);ay=false}}else{ax.multiplyScalar(1/ar)}}}if(aA!==aC.length){this._log("Skinning did not consume all weights",aa.messageError)}ak.morphTargets.push({name:"target",vertices:aj})}ak.computeMorphNormals();aB.morphTargets=true;aB.morphNormals=true;if(aB.materials!=null){at=aB.materials;for(aR=0,am=at.length;aR<am;aR++){aQ=at[aR];aQ.morphTargets=true;aQ.morphNormals=true}}return true};ah.prototype._prepareAnimations=function(ap){var ax,av,ak,au,ao,al,ar,aq,an,aw,aj,ai,at,am;ao=null;for(ar=0,aw=ap.length;ar<aw;ar++){ax=ap[ar];au=false;at=ax.node.transformations;for(aq=0,aj=at.length;aq<aj;aq++){al=at[aq];al.resetAnimation();al.selectAllAnimations();am=al.animTarget.activeChannels;for(an=0,ai=am.length;an<ai;an++){av=am[an];au=true;ak=av.inputData.length;if((ao!=null)&&ak!==ao){this._log("Inconsistent number of time steps, no morph targets added for mesh. Resample all animations to fix this.",aa.messageError);return null}ao=ak}}if(this._options.verboseMessages&&!au){this._log("Joint '"+ax.sid+"' has no animation channel",aa.messageWarning)}}return ao};ah.prototype._updateSkinMatrices=function(aj,al,am){var ap,ao,an,ak,ai;for(ao=0,ak=aj.length;ao<ak;ao++){ap=aj[ao];ap.applyAnimation(am)}for(an=0,ai=aj.length;an<ai;an++){ap=aj[an];ap.updateSkinMatrix(al)}return null};ah.prototype._addSkinBones=function(ai,a8,aY,aI){var aX,aF,aq,aV,aO,aP,aD,al,a5,ak,aB,aj,a1,aK,ay,ar,aN,a9,aG,aZ,aQ,a7,aM,aT,au,aC,a6,aH,aL,aW,aJ,aR,az,ap,aS,aE,a0,a4,a3,a2,aA,ao,an,am,aU,ax,aw,av,at;aT=this._prepareAnimations(aY);if(!aT>0){return null}aN=ai.vertices;a6=aN.length;aJ=a8.vertexWeights.v;aR=a8.vertexWeights.vcount;aW=this._getLinkTarget(a8.vertexWeights.joints.source);ap=this._getLinkTarget(a8.vertexWeights.weights.source);aL=aW!=null?aW.data:void 0;az=ap!=null?ap.data:void 0;if(!(az!=null)){this._log("Skin has no weights data, no skin added for mesh",aa.messageError);return null}aX=new THREE.Matrix4;if(a8.bindShapeMatrix!=null){aX=W(a8.bindShapeMatrix,0)}aK=new THREE.Vector3();ay=new THREE.Quaternion();ar=new THREE.Vector3();al=true;aD=true;a7=[];aM=[];aH=0;aP=4;ak=[0,0,0,0];a0=[0,0,0,0];for(a5=0,aA=aN.length;a5<aA;a5++){aC=aN[a5];aE=aR[a5];if(aE>aP){if(al){this._log("Too many bones influence a vertex, some influences will be discarded. Threejs supports only "+aP+" bones per vertex.",aa.messageWarning);al=false}aE=aP}au=0;for(aS=0,aU=aE-1;aS<=aU;aS+=1){aq=aJ[aH];aO=aJ[aH+1];aH+=2;aV=az[aO];au+=aV;ak[aS]=aq;a0[aS]=aV}for(aS=a0,ax=aP-1;aS<=ax;aS+=1){ak[aS]=0;a0[aS]=0}if(!((0.01<au&&au<1000000))){if(aD){this._log("Zero or infinite total weight for skinned vertex, skin will be broken",aa.messageWarning);aD=false}}else{for(aS=0,aw=aP-1;aS<=aw;aS+=1){a0[aS]/=au}}a7.push(new THREE.Vector4(ak[0],ak[1],ak[2],ak[3]));aM.push(new THREE.Vector4(a0[0],a0[1],a0[2],a0[3]))}ai.skinIndices=a7;ai.skinWeights=aM;aQ=[];for(a4=0,ao=aY.length;a4<ao;a4++){aF=aY[a4];aG={};if(aF.parent!=null){aG.parent=aF.parent.index}else{aG.parent=-1}aG.name=aF.node.name;aF.matrix.decompose(aK,ay,ar);aG.pos=[aK.x,aK.y,aK.z];aG.scl=[ar.x,ar.y,ar.z];aG.rotq=[ay.x,ay.y,ay.z,ay.w];aG.rot=null;aG.inverse=new THREE.Matrix4;aG.inverse.multiplyMatrices(aF.invBindMatrix,aX);aQ.push(aG)}ai.bones=aQ;a9={};a9.name="animation";a9.hierarchy=[];for(a3=0,an=aY.length;a3<an;a3++){aF=aY[a3];aZ={};aZ.parent=aF.index;aZ.keys=[];for(aj=0,av=aT-1;aj<=av;aj+=1){aF.applyAnimation(aj);aF.updateSkinMatrix(aX);aB={};aB.time=aj;aF.matrix.decompose(aK,ay,ar);aB.pos=[aK.x,aK.y,aK.z];aB.scl=[ar.x,ar.y,ar.z];aB.rot=[ay.x,ay.y,ay.z,ay.w];aZ.keys.push(aB)}a9.hierarchy.push(aZ)}a9.fps=30;a9.length=aT-1;ai.animation=a9;aI.skinning=true;if(aI.materials!=null){at=aI.materials;for(a2=0,am=at.length;a2<am;a2++){a1=at[a2];a1.skinning=true}}return true};ah.prototype._createMorphMesh=function(ai,aj){this._log("Morph animated meshes not supported, mesh ignored",aa.messageError);return null};ah.prototype._createGeometry=function(al,ak){var ai,am,ap,ao,aj,an;am=new THREE.Geometry();an=al.triangles;for(ao=0,aj=an.length;ao<aj;ao++){ap=an[ao];ai=ak.indices[ap.material];if(!(ai!=null)){this._log("Material symbol "+ap.material+" has no bound material instance",aa.messageError);ai=0}this._addTrianglesToGeometry(al,ap,ai,am)}am.computeFaceNormals();am.computeCentroids();if(ak.needtangents){am.computeTangents()}am.computeBoundingBox();return am};ah.prototype._addTrianglesToGeometry=function(bl,aX,aN,bd){var aJ,aI,aH,aS,az,ay,aU,ai,aM,au,aF,aA,aD,al,be,aO,aC,bu,bg,a4,aE,aL,bf,ao,a1,aQ,bt,bp,bo,bn,aT,bb,bc,aW,bm,a9,aB,bi,bh,aK,bj,aG,ax,bs,br,bq,aY,am,bk,a2,a0,aZ,aV,aP,an,ak,aj,at,ba,a8,a7,a6,a5,a3,bv,ar,aq,ap,aR,av,aw=this;aL=null;a4=null;bg=null;aE=[];bv=aX.inputs;for(an=0,at=bv.length;an<at;an++){bu=bv[an];switch(bu.semantic){case"VERTEX":aL=bu;break;case"NORMAL":a4=bu;break;case"COLOR":bg=bu;break;case"TEXCOORD":aE.push(bu);break;default:this._log("Unknown triangles input semantic "+bu.semantic+" ignored",aa.messageWarning)}}bh=this._getLinkTarget(aL.source,R);if(!(bh!=null)){this._log("Geometry "+bl.id+" has no vertices",aa.messageError);return}aB=this._getLinkTarget(a4!=null?a4.source:void 0,I);a9=this._getLinkTarget(bg!=null?bg.source:void 0,I);bi=aE.map(function(bw){return aw._getLinkTarget(bw!=null?bw.source:void 0,I)});a1=null;ao=null;bf=null;aQ=[];ar=bh.inputs;for(ak=0,ba=ar.length;ak<ba;ak++){bu=ar[ak];switch(bu.semantic){case"POSITION":a1=bu;break;case"NORMAL":ao=bu;break;case"COLOR":bf=bu;break;case"TEXCOORD":aQ.push(bu);break;default:this._log("Unknown vertices input semantic "+bu.semantic+" ignored",aa.messageWarning)}}aG=this._getLinkTarget(a1.source,I);if(!(aG!=null)){this._log("Geometry "+bl.id+" has no vertex positions",aa.messageError);return}bj=this._getLinkTarget(ao!=null?ao.source:void 0,I);aK=this._getLinkTarget(bf!=null?bf.source:void 0,I);ax=aQ.map(function(bw){return aw._getLinkTarget(bw!=null?bw.source:void 0,I)});aA=this._createVector3Array(aG);aF=this._createVector3Array(bj);ai=this._createVector3Array(aB);au=this._createColorArray(aK);aU=this._createColorArray(a9);aD=ax.map(function(bw){return aw._createUVArray(bw)});aM=bi.map(function(bw){return aw._createUVArray(bw)});bd.vertices=aA;bm=aD.length+aM.length;bc=bd.faceVertexUvs.length;aW=aX.count;bb=bd.faces.count;aq=bd.faceVertexUvs;for(aO=0,a8=aq.length;aO<a8;aO++){be=aq[aO];if(aO<bm){bt=be.length-bd.faces.length;this._addEmptyUVs(be,bt)}else{bt=be.length-bd.faces.length+aW;this._addEmptyUVs(be,bt)}}while(bd.faceVertexUvs.length<bm){be=[];this._addEmptyUVs(be,bb);bd.faceVertexUvs.push(be)}if(aX.type!=="triangles"){aV=aX.vcount;for(aj=0,a7=aV.length;aj<a7;aj++){aS=aV[aj];if(aS!==3){this._log("Geometry "+bl.id+" has non-triangle polygons, geometry ignored",aa.messageError);return}}}aC=aX.indices;bk=aC.length/aX.count;aP=bk/3;ap=aX.indices;for(am=0,a6=ap.length,aR=bk;am<a6;am+=aR){av=ap[am];aJ=am+0*aP;aI=am+1*aP;aH=am+2*aP;a2=aC[aJ+aL.offset];a0=aC[aI+aL.offset];aZ=aC[aH+aL.offset];if(aF!=null){aT=[aF[a2],aF[a0],aF[aZ]]}else{if(ai!=null){bp=aC[aJ+a4.offset];bo=aC[aI+a4.offset];bn=aC[aH+a4.offset];aT=[ai[bp],ai[bo],ai[bn]]}else{aT=null}}if(au!=null){az=[au[a2],au[a0],au[aZ]]}else{if(aU!=null){bp=aC[aJ+bg.offset];bo=aC[aI+bg.offset];bn=aC[aH+bg.offset];az=[aU[bp],aU[bo],aU[bn]]}else{az=null}}al=new THREE.Face3(a2,a0,aZ,aT,az);if(aN!=null){al.materialIndex=aN}bd.faces.push(al);for(aO=0,a5=aD.length;aO<a5;aO++){ay=aD[aO];if(!(ay!=null)){geometry.faceVertexUvs[aO].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)])}else{aY=[ay[a2],ay[a0],ay[aZ]];geometry.faceVertexUvs[aO].push(aY)}}for(aO=0,a3=aM.length;aO<a3;aO++){ay=aM[aO];if(!(ay!=null)){geometry.faceVertexUvs[aO].push([new THREE.Vector2(0,0),new THREE.Vector2(0,0),new THREE.Vector2(0,0)])}else{bs=aC[aJ+aE[aO].offset];br=aC[aI+aE[aO].offset];bq=aC[aH+aE[aO].offset];aY=[ay[bs],ay[br],ay[bq]];bd.faceVertexUvs[aO].push(aY)}}}};ah.prototype._addEmptyUVs=function(al,aj){var ai,ak;for(ai=0,ak=aj-1;ai<=ak;ai+=1){al.push(new THREE.Vector2(0,0))}};ah.prototype._createVector3Array=function(al){var ak,ai,am,aj;if(!(al!=null)){return null}if(al.stride!==3){this._log("Vector source data does not contain 3D vectors",aa.messageError);return null}ak=[];am=al.data;for(ai=0,aj=am.length-1;ai<=aj;ai+=3){ak.push(new THREE.Vector3(am[ai],am[ai+1],am[ai+2]))}return ak};ah.prototype._createColorArray=function(al){var ak,ai,am,aj,an;if(!(al!=null)){return null}if(al.stride<3){this._log("Color source data does not contain 3+D vectors",aa.messageError);return null}ak=[];am=al.data;for(ai=0,aj=am.length-1,an=al.stride;0<=aj?ai<=aj:ai>=aj;ai+=an){ak.push(new THREE.Color().setRGB(am[ai],am[ai+1],am[ai+2]))}return ak};ah.prototype._createUVArray=function(al){var ak,ai,am,aj,an;if(!(al!=null)){return null}if(al.stride<2){this._log("UV source data does not contain 2+D vectors",aa.messageError);return null}ak=[];am=al.data;for(ai=0,aj=am.length-1,an=al.stride;0<=aj?ai<=aj:ai>=aj;ai+=an){ak.push(new THREE.Vector2(am[ai],1-am[ai+1]))}return ak};ah.prototype._createMaterials=function(aj){var ap,an,ai,am,ao,al,ak;ai=new H;an=0;for(al=0,ak=aj.length;al<ak;al++){ap=aj[al];am=ap.symbol;if(!(am!=null)){this._log("Material instance has no symbol, material skipped.",aa.messageError);continue}if(ai.indices[am]!=null){this._log("Geometry instance tried to map material symbol "+am+" multiple times",aa.messageError);continue}ao=this._createMaterial(ap);if((ao.bumpMap!=null)||(ao.normalMap!=null)){ai.needtangents=true}this.threejs.materials.push(ao);ai.materials.push(ao);ai.indices[am]=an++}return ai};ah.prototype._createMaterial=function(ak){var aj,ai;ai=this._getLinkTarget(ak.material,G);if(!(ai!=null)){return this._createDefaultMaterial}aj=this._getLinkTarget(ai.effect,d);if(!(aj!=null)){return this._createDefaultMaterial}return this._createBuiltInMaterial(aj)};ah.prototype._createShaderMaterial=function(at){var ak,ap,aj,ai,aq,au,an,ar,ao,am,al;aj=at.technique;ap=THREE.ShaderUtils.lib.normal;ar=THREE.UniformsUtils.clone(ap.uniforms);au=this._loadThreejsTexture(aj.bump);if(au!=null){ar.tNormal.texture=au;ar.uNormalScale.value=0.85}ai=this._loadThreejsTexture(aj.diffuse);if(ai!=null){ar.tDiffuse.texture=ai;ar.enableDiffuse.value=true}else{ar.enableDiffuse.value=false}an=this._loadThreejsTexture(aj.specular);if(an!=null){ar.tSpecular.texture=an;ar.enableSpecular.value=true}else{ar.enableSpecular.value=false}aq=this._loadThreejsTexture(aj.emission);if(aq!=null){ar.tAO.texture=aq;ar.enableAO.value=true}else{ar.enableAO.value=false}if(((ao=aj.diffuse)!=null?ao.color:void 0)!=null){ar.uDiffuseColor.value.setHex(ae(aj.diffuse.color))}if(((am=aj.specular)!=null?am.color:void 0)!=null){ar.uSpecularColor.value.setHex(ae(aj.specular.color))}if(((al=aj.ambient)!=null?al.color:void 0)!=null){ar.uAmbientColor.value.setHex(ae(aj.ambient.color))}if(aj.shininess!=null){ar.uShininess.value=aj.shininess}if(aj.transparency!=null){ar.uOpacity.value=this._getOpacity(at)}ak=new THREE.ShaderMaterial({fragmentShader:ap.fragmentShader,vertexShader:ap.vertexShader,uniforms:ar,lights:true});return ak};ah.prototype._getOpacity=function(an){var al,am,ai,ao,aj,ak;am=an.technique;ao=am.transparent;al=ao!=null?ao.opaque:void 0;if((al!=null)&&al!=="A_ONE"){this._log("Opacity mode "+al+" not supported, transparency will be broken",aa.messageWarning)}if((ao!=null?ao.textureSampler:void 0)!=null){this._log("Separate transparency texture not supported, transparency will be broken",aa.messageWarning)}aj=(ao!=null?(ak=ao.color)!=null?ak[3]:void 0:void 0)||1;ai=am.transparency||1;return aj*ai};ah.prototype._hasTransparency=function(ak){var aj,ai,al;aj=ak.technique;return(((ai=aj.transparent)!=null?ai.textureSampler:void 0)!=null)||((0>=(al=aj.transparency)&&al>=1))};ah.prototype._createBuiltInMaterial=function(al){var ai,aj,am,ak;ak=al.technique;am={};this._setThreejsMaterialParam(am,ak.diffuse,"diffuse","map",false);this._setThreejsMaterialParam(am,ak.emission,"emissive",null,false);this._setThreejsMaterialParam(am,ak.ambient,"ambient","lightMap",false);this._setThreejsMaterialParam(am,ak.specular,"specular","specularMap",false);this._setThreejsMaterialParam(am,ak.bump,null,"normalMap",false);if(am.bumpMap){am.bumpScale=1}if(am.normalMap){am.normalScale=new THREE.Vector2(1,1)}if(am.map!=null){am.diffuse=16777215}if(am.specularMap!=null){am.specular=16777215}if(!(am.diffuse!=null)){am.diffuse=16777215}if(ak.shininess!=null){am.shininess=ak.shininess}if(ak.reflectivity!=null){am.reflectivity=ak.reflectivity}ai=this._hasTransparency(al);if(ai){am.transparent=true;aj=this._getOpacity(al);am.opacity=aj;am.alphaTest=0.001}if(ak.doubleSided){am.side=THREE.DoubleSide}am.shading=THREE.SmoothShading;am.perPixel=true;switch(ak.shading){case"blinn":case"phong":am.color=am.diffuse;return new THREE.MeshPhongMaterial(am);case"lambert":am.color=am.diffuse;return new THREE.MeshLambertMaterial(am);case"constant":am.color=am.emission;return new THREE.MeshBasicMaterial(am);default:return this._createDefaultMaterial}};ah.prototype._createDefaultMaterial=function(){return new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading})};ah.prototype._setThreejsMaterialParam=function(an,am,al,ak,aj){var ai;if(!(am!=null)){return}if((am.color!=null)&&(al!=null)){if(!aj&&(an[al]!=null)){return}an[al]=ae(am.color)}else{if((am.textureSampler!=null)&&(ak!=null)){if(!aj&&(an[ak]!=null)){return}ai=this._loadThreejsTexture(am);if(ai!=null){an[ak]=ai}}}};ah.prototype._loadThreejsTexture=function(am){var ak,al,aj,ai,an;if(!(am.textureSampler!=null)){return null}ai=this._getLinkTarget(am.textureSampler,a);if(!(ai!=null)){return null}aj=null;if(ai.image!=null){aj=this._getLinkTarget(ai.image,O)}else{if(ai.surface!=null){an=this._getLinkTarget(ai.surface,ab);aj=this._getLinkTarget(an.initFrom,O)}}if(!(aj!=null)){return null}ak=this._baseUrl+aj.initFrom;al=this._loader._loadTextureFromURL(ak);return al};return ah})();aa=(function(){ah.messageTrace=0;ah.messageInfo=1;ah.messageWarning=2;ah.messageError=3;ah.messageTypes=["TRACE","INFO","WARNING","ERROR"];function ah(){this.log=ah.logConsole;this._imageCache={};this.options={useAnimations:true,convertSkinsToMorphs:false,verboseMessages:false,localImageMode:false}}ah.logConsole=function(aj,ai){console.log("ColladaLoader2 "+ah.messageTypes[ai]+": "+aj)};ah.prototype.setLog=function(ai){this.log=ai||this.logConsole};ah.prototype.addChachedTextures=function(ai){var aj,ak;for(aj in ai){ak=ai[aj];this._imageCache[aj]=ak}};ah.prototype.load=function(ai,ao,am){var ak,aj,al,an=this;ak=0;if((al=document.implementation)!=null?al.createDocument:void 0){aj=new XMLHttpRequest();if(typeof aj.overrideMimeType==="function"){aj.overrideMimeType("text/xml")}aj.onreadystatechange=function(){if(aj.readyState===4){if(aj.status===0||aj.status===200){if(aj.responseXML){return an.parse(aj.responseXML,ao,ai)}else{return an.log("Empty or non-existing file "+ai+".",ah.messageError)}}}else{if(aj.readyState===3){if(am){if(ak===0){ak=aj.getResponseHeader("Content-Length")}return am({total:ak,loaded:aj.responseText.length})}}}};aj.open("GET",ai,true);aj.send(null)}else{this.log("Don't know how to parse XML!",ah.messageError)}};ah.prototype.parse=function(ak,al,ai){var aj;aj=new v(this);aj.setUrl(ai);aj._readyCallback=al;aj._parseXml(ak);aj._linkAnimations();aj._createSceneGraph();if(aj._readyCallback){aj._readyCallback(aj)}return aj};ah.prototype._loadTextureFromURL=function(ai){var aj;aj=this._imageCache[ai];if(aj!=null){return aj}if(this.options.localImageMode){aj=this._loadImageLocal(ai)}if(!(aj!=null)){aj=this._loadImageSimple(ai)}if(aj!=null){this._imageCache[ai]=aj}else{this.log("Texture "+ai+" could not be loaded, texture will be ignored.",ah.messageError)}return aj};ah.prototype._loadImageThreejs=function(ai){var aj;aj=THREE.ImageUtils.loadTexture(ai);aj.flipY=false;return aj};ah.prototype._loadImageSimple=function(ai){var ak,aj;ak=new Image();aj=new THREE.Texture(ak);aj.flipY=false;aj.wrapS=THREE.RepeatWrapping;aj.wrapT=THREE.RepeatWrapping;ak.onload=function(){return aj.needsUpdate=true};ak.crossOrigin="anonymous";ak.src=ai;return aj};ah.prototype._loadImageLocal=function(ak){var ai,ap,aj,al,an,am,ao;ap=this._removeSameDirectoryPath(ak);am=this._imageCache;for(aj in am){an=am[aj];ai=this._removeSameDirectoryPath(aj);if(ap.indexOf(ai)>=0){al=an;break}}ap=this._removeSameDirectoryPath(this._removeFileExtension(ak));if(!(al!=null)){ao=this._imageCache;for(aj in ao){an=ao[aj];ai=this._removeSameDirectoryPath(this._removeFileExtension(aj));if(ap.indexOf(ai)>=0){al=an;break}}}return al};ah.prototype._removeFileExtension=function(ai){return ai.substr(0,ai.lastIndexOf("."))||ai};ah.prototype._removeSameDirectoryPath=function(ai){return ai.replace(/^.\//,"")};return ah})();N=function(ai){var ah;if(ai.length>0){ah=ai.trim();return ah.split(/\s+/)}else{return[]}};L=function(am){var al,ak,aj,ah,ai;ah=N(am);al=new Float32Array(ah.length);for(ak=0,ai=ah.length;ak<ai;ak++){aj=ah[ak];al[ak]=parseFloat(aj)}return al};l=function(am){var al,ak,aj,ah,ai;ah=N(am);al=new Int32Array(ah.length);for(ak=0,ai=ah.length;ak<ai;ak++){aj=ah[ak];al[ak]=parseInt(aj,10)}return al};A=function(an){var am,ak,aj,ah,ai,al;ah=N(an);am=new Uint8Array(ah.length);for(ak=0,ai=ah.length;ak<ai;ak++){aj=ah[ak];am[ak]=(al=aj==="true"||aj==="1")!=null?al:{1:0}}return am};D=function(ai){var ah;ah=L(ai);if(ah.length===4){return ah}else{return null}};ae=function(ah){if(ah!=null){return Math.floor(ah[0]*255)<<16^Math.floor(ah[1]*255)<<8^Math.floor(ah[2]*255)}else{return null}};y=function(ah,ai){return new THREE.Matrix4(ah[0+ai],ah[4+ai],ah[8+ai],ah[12+ai],ah[1+ai],ah[5+ai],ah[9+ai],ah[13+ai],ah[2+ai],ah[6+ai],ah[10+ai],ah[14+ai],ah[3+ai],ah[7+ai],ah[11+ai],ah[15+ai])};W=function(ah,ai){return new THREE.Matrix4(ah[0+ai],ah[1+ai],ah[2+ai],ah[3+ai],ah[4+ai],ah[5+ai],ah[6+ai],ah[7+ai],ah[8+ai],ah[9+ai],ah[10+ai],ah[11+ai],ah[12+ai],ah[13+ai],ah[14+ai],ah[15+ai])};f=function(ai,aj,ah){return ah.set(ai[0+aj],ai[4+aj],ai[8+aj],ai[12+aj],ai[1+aj],ai[5+aj],ai[9+aj],ai[13+aj],ai[2+aj],ai[6+aj],ai[10+aj],ai[14+aj],ai[3+aj],ai[7+aj],ai[11+aj],ai[15+aj])};X=function(ai,aj,ah){return ah.set(ai[0+aj],ai[1+aj],ai[2+aj],ai[3+aj],ai[4+aj],ai[5+aj],ai[6+aj],ai[7+aj],ai[8+aj],ai[9+aj],ai[10+aj],ai[11+aj],ai[12+aj],ai[13+aj],ai[14+aj],ai[15+aj])};s=function(ai){var ah,al,ak,aj;aj=ai.elements;if(aj[3]!==0||aj[7]!==0||aj[11]!==0||aj[15]!==1){throw new Error("Last row isnt [0,0,0,1]")}ah=Math.sqrt(aj[0]*aj[0]+aj[1]*aj[1]+aj[2]*aj[2]);al=Math.sqrt(aj[4]*aj[4]+aj[5]*aj[5]+aj[6]*aj[6]);ak=Math.sqrt(aj[8]*aj[8]+aj[9]*aj[9]+aj[10]*aj[10]);if(ah<0.9||ah>1.1){throw new Error("First column has significant scaling")}if(al<0.9||al>1.1){throw new Error("Second column has significant scaling")}if(ak<0.9||ak>1.1){throw new Error("Third column has significant scaling")}};j=function(ah){return new THREE.Vector3(ah[0],ah[1],ah[2])};P=Math.PI/180;aa.prototype.setLog=aa.prototype.setLog;aa.prototype.addChachedTextures=aa.prototype.addChachedTextures;aa.prototype.load=aa.prototype.load;aa.prototype.parse=aa.prototype.parse;if(typeof module!=="undefined"&&module!==null){module.exports=aa}else{if(typeof window!=="undefined"&&window!==null){window.ColladaLoader2=aa}}}).call(this);